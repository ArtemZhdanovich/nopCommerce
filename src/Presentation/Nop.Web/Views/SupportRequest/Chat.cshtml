@using Nop.Core
@model SupportChatViewModel
@inject Nop.Core.IWebHelper webHelper
@{
    Layout = "_ColumnsTwo";

    //title
    NopHtml.AddTitleParts("Support Request Chat");
    //page class
    // NopHtml.AppendPageCssClassParts("html-account-page");
    // NopHtml.AppendPageCssClassParts("html-customer-info-page");
}

@section left
{
    @await Component.InvokeAsync(typeof(CustomerNavigationViewComponent), new { selectedTabId = CustomerNavigationEnum.SupportRequests })
}

<div class="page account-page customer-info-page">
    <div class="page-title">
        <h1>Support Request - Chat</h1>
    </div>
    <div class="page-body">
        <div id="support-chat-page">
            <section class="row">
                <div class="column">

                    <a asp-action="List" class="btn btn-secondary">Back</a>

                    <ol class="chat-info-list">
                        <li class="heading">Request No.</li>
                        <li class="info">@Model.RequestId</li>
                        <li class="heading">Subject</li>
                        <li class="info">@Model.Subject</li>
                        <li class="heading">Status</li>
                        <li class="info">@Model.Status</li>
                    </ol>

                    <form asp-action="AddMessage" method="post">
                        <input type="hidden" asp-for="RequestId" value="@Model.RequestId"/>
                        <div class="form-group">
                            <textarea asp-for="NewMessage" class="form-control" placeholder="Type your message here..."></textarea>
                            <span asp-validation-for="NewMessage" class="text-danger"></span>
                        </div>
                        <div class="action-btn-cntr">
                            <button type="submit" class="btn btn-primary">Send</button>
                        </div>
                    </form>
                </div>
                    <div class="column">
                        @if (!Model.Messages.Any())
                        {
                            <p>No chat messages.</p>
                        }
                        else
                        {
                            <table>
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Request ID</th>
                                    <th>Author ID</th>
                                    <th>IsAdmin</th>
                                    <th>CreatedOnUtc</th>
                                    <th>Message</th>
                                </tr>
                                </thead>
                                <tbody>
                                @foreach (var message in Model.Messages)
                                {
                                    <tr>
                                        <td>@message.Id</td>
                                        <td>@message.RequestId</td>
                                        <td>@message.AuthorId</td>
                                        <td>@message.IsAdmin</td>
                                        <td>@message.CreatedOnUtc</td>
                                        <td>@message.Message</td>
                                    </tr>
                                }
                                </tbody>
                            </table>
                        }
                    </div>
            </section>
        </div>
    </div>
</div>

<script asp-location="Footer">
    function removeexternalassociation(itemId) {
        if (confirm('@T("Common.AreYouSure")')) {
            var postData = {
                id: itemId
            };
            addAntiForgeryToken(postData);
            $.ajax({
                cache: false,
                type: "POST",
                url: "@Url.RouteUrl("CustomerRemoveExternalAssociation")",
                data: postData,
                dataType: "json",
                success: function (data, textStatus, jqXHR) {
                    location.href = data.redirect;
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert('Failed to delete');
                }
            });
        }
        return false;
    }
</script>
